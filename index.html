<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script> 
    <title>Matching</title>
    <style>
        html,body {
        height: 100%;
        width: 100%;
        margin: 0px;
        padding: 0px;
        }

        #mynetwork{
            height: 100%;
            top: 0px;
            bottom: 0px;
            right: 0px;
            left: 0px;
        }
    </style>
</head>
<body>
    <div id="mynetwork" class="carousel-item-inner"></div>
    
    <script type="module">
        import {node,matchingGraph} from "./js/script.js";//マッチングライブラリ

        //人間関係グラフ
        // create an array with nodes
        import staff from "./data/staff.json" assert { type: "json" };
        import works from "./data/works.json" assert {type:"json"};
        
        const staff_nodes = [...Array(staff.length)].map((i,j)=>new node(j,staff[j]));
        const works_nodes = [...Array(works.length)].map((i,j)=>new node(j,works[j]));

        let mgraph = new matchingGraph(staff_nodes,works_nodes);//インスタンス化

        //辺の追加

        for (const i of staff_nodes){
            for (const j of i.data.capable){
                // jは役職の名前　例:A,B (..etc)
                mgraph.addSide(
                    i.id,
                    works.indexOf(j)
                );
            }
        }

        let max_match = mgraph.maxMatching();
        console.log(
            "マックスマッチング",
            max_match
        );
        for (const i of mgraph.maxMatching2()){
            console.log(i);
        }

        //頂点の設定
        let nodeList = [...Array(staff.length).keys()]
            .map(function (i){
                return {
                    id : i,
                    label : staff[i].name,
                    x : 100,
                    y : i*120,
                    shape: "box",
                    color: "#f9a8ff"
                }
            }).concat([...Array(works.length).keys()]
                .map(function(i){
                return {
                    id : i+staff.length,
                    label : works[i],
                    x : 1000,
                    y : i*120
                }
            })
            );

        //辺の設定
        let edgeList = [];
        for (let i=0; i< staff.length;i++){
            for (const j of staff[i].capable){
                let edge={
                    from:i,
                    to:staff.length+works.indexOf(j)
                };
                if (max_match.some(k=>k[0]==i&&k[1]==works.indexOf(j))){//最大マッチングのリストに含まれているかどうか
                    edge["color"]={ color: "#ff0000"} ;
                }else{
                    edge["color"]={ color: "#0000ff"} ;
                }
                edgeList.push(edge);
            }
        }

        var nodes = new vis.DataSet(nodeList);

        // create an array with edges
        var edges = new vis.DataSet(edgeList);

        // create a network
        var container = document.getElementById("mynetwork");
        var data = {
        nodes: nodes,
        edges: edges,
        };
        var options = {
            physics: {
                enabled: false,
            },
        };
        var network = new vis.Network(container, data, options);
    
    </script>
</body>
</html>